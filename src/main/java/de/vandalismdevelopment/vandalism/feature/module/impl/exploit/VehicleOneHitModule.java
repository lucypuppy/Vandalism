package de.vandalismdevelopment.vandalism.feature.module.impl.exploit;

import de.florianmichael.dietrichevents2.DietrichEvents2;
import de.vandalismdevelopment.vandalism.base.event.player.AttackListener;
import de.vandalismdevelopment.vandalism.feature.module.AbstractModule;
import de.vandalismdevelopment.vandalism.base.value.Value;
import de.vandalismdevelopment.vandalism.base.value.impl.number.IntegerValue;
import net.minecraft.entity.vehicle.AbstractMinecartEntity;
import net.minecraft.entity.vehicle.BoatEntity;
import net.minecraft.network.packet.c2s.play.PlayerInteractEntityC2SPacket;

public class VehicleOneHitModule extends AbstractModule implements AttackListener {

    private final Value<Integer> packets = new IntegerValue(
            this,
            "Packets",
            "The amount of packets per hit to send.",
            19,
            3,
            40
    );

    public VehicleOneHitModule() {
        super("Vehicle One Hit", "Allows you to destroy vehicles with one hit.", Category.EXPLOIT);
    }

    @Override
    public void onEnable() {
        DietrichEvents2.global().subscribe(AttackSendEvent.ID, this);
    }

    @Override
    public void onDisable() {
        DietrichEvents2.global().unsubscribe(AttackSendEvent.ID, this);
    }

    @Override
    public void onAttackSend(final AttackSendEvent event) {
        if (event.target instanceof AbstractMinecartEntity || event.target instanceof BoatEntity) {
            for (int i = 0; i < this.packets.getValue(); i++) {
                this.mc.getNetworkHandler().sendPacket(PlayerInteractEntityC2SPacket.attack(event.target, this.mc.player.isSneaking()));
            }
        }
    }

}
