package de.vandalismdevelopment.vandalism.feature.command.impl.exploit;

import com.mojang.brigadier.arguments.LongArgumentType;
import com.mojang.brigadier.arguments.StringArgumentType;
import com.mojang.brigadier.builder.LiteralArgumentBuilder;
import de.vandalismdevelopment.vandalism.feature.command.AbstractCommand;
import de.vandalismdevelopment.vandalism.util.minecraft.ChatUtil;
import net.minecraft.command.CommandSource;

import java.util.concurrent.Executors;

public class SkriptDupeCommand extends AbstractCommand {

    public SkriptDupeCommand() {
        super(
                "Allows you to dupe on servers that are using the plugin skript for guis.",
                Category.EXPLOIT,
                "skriptdupe",
                "skdupe",
                "dupesk",
                "dupeskript",
                "skriptguidupe"
        );
    }

    @Override
    public void build(final LiteralArgumentBuilder<CommandSource> builder) {
        builder.then(argument("delay", LongArgumentType.longArg(100, 15000))
                .then(argument("skript-gui-command", StringArgumentType.word())
                        .then(argument("layer-gui-command", StringArgumentType.word())
                                .executes(context -> {
                                    Executors.newSingleThreadExecutor().submit(() -> {
                                        if (this.mc.getNetworkHandler() != null) {
                                            try {
                                                final long delay = LongArgumentType.getLong(context, "delay");
                                                final String
                                                        skriptGuiCommand = StringArgumentType.getString(context, "skript-gui-command"),
                                                        layerGuiCommand = StringArgumentType.getString(context, "layer-gui-command");
                                                this.mc.getNetworkHandler().sendChatCommand(skriptGuiCommand);
                                                Thread.sleep(delay);
                                                this.mc.getNetworkHandler().sendChatCommand(layerGuiCommand);
                                                Thread.sleep(delay);
                                                this.mc.getNetworkHandler().sendChatCommand(skriptGuiCommand);
                                            } catch (final Throwable throwable) {
                                                ChatUtil.errorChatMessage("Failed to dupe with skript due to: " + throwable);
                                            }
                                        }
                                    });
                                    return SINGLE_SUCCESS;
                                })
                        )
                )
        );
    }

}
