package de.vandalismdevelopment.vandalism.feature.command.impl.exploit;

import com.mojang.brigadier.arguments.StringArgumentType;
import com.mojang.brigadier.builder.LiteralArgumentBuilder;
import de.vandalismdevelopment.vandalism.feature.command.AbstractCommand;
import net.minecraft.block.entity.CommandBlockBlockEntity;
import net.minecraft.command.CommandSource;
import net.minecraft.network.packet.c2s.play.UpdateCommandBlockC2SPacket;
import net.minecraft.util.math.BlockPos;

public class CommandBlockStateCommand extends AbstractCommand {

    public CommandBlockStateCommand() {
        super(
                "Checks if command blocks are enabled on the server.",
                Category.EXPLOIT,
                "commandblockstate",
                "cmdblockcheck",
                "checkcmdblock",
                "checkcommandblock",
                "cmdblockstatecheck"
        );
    }

    @Override
    public void build(final LiteralArgumentBuilder<CommandSource> builder) {
        builder.then(argument("command", StringArgumentType.greedyString()).executes(context -> {
            final String command = context.getArgument("command", String.class);
            if (this.mc.getNetworkHandler() != null) {
                this.mc.getNetworkHandler().sendPacket(new UpdateCommandBlockC2SPacket(
                        BlockPos.ORIGIN, command,
                        CommandBlockBlockEntity.Type.AUTO,
                        false,
                        false,
                        false
                ));
            }

            return SINGLE_SUCCESS;
        }));
    }

}
