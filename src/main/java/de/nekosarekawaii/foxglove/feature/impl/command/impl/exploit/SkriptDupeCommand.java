package de.nekosarekawaii.foxglove.feature.impl.command.impl.exploit;

import com.mojang.brigadier.arguments.LongArgumentType;
import com.mojang.brigadier.arguments.StringArgumentType;
import com.mojang.brigadier.builder.LiteralArgumentBuilder;
import de.nekosarekawaii.foxglove.feature.Feature;
import de.nekosarekawaii.foxglove.feature.FeatureCategory;
import de.nekosarekawaii.foxglove.feature.impl.command.Command;
import de.nekosarekawaii.foxglove.feature.impl.command.CommandInfo;
import de.nekosarekawaii.foxglove.util.minecraft.ChatUtils;
import net.minecraft.client.network.ClientPlayNetworkHandler;
import net.minecraft.command.CommandSource;

@CommandInfo(name = "Skript Dupe", aliases = {"skriptdupe", "dupeskript", "skdupe", "dupesk"}, description = "Allows you to dupe items on servers that are using the skript plugin for their guis.", category = FeatureCategory.EXPLOIT)
public class SkriptDupeCommand extends Command {

    @Override
    public void build(final LiteralArgumentBuilder<CommandSource> builder) {
        builder.then(argument("delay", LongArgumentType.longArg(100, 15000))
                        .then(argument("skript-gui-command", StringArgumentType.word())
                                .then(argument("layer-gui-command", StringArgumentType.word())
                                        .executes(context -> {
                                            new Thread(() -> {
                                                final ClientPlayNetworkHandler networkHandler = Feature.mc.getNetworkHandler();
                                                if (networkHandler != null) {
                                                    try {
                                                        final long delay = LongArgumentType.getLong(context, "delay");
                                                        final String skriptGuiCommand = StringArgumentType.getString(context, "skript-gui-command");
                                                        final String layerGuiCommand = StringArgumentType.getString(context, "layer-gui-command");
                                                        networkHandler.sendChatCommand(skriptGuiCommand);
                                                        Thread.sleep(delay);
                                                        networkHandler.sendChatCommand(layerGuiCommand);
                                                        Thread.sleep(delay);
                                                        networkHandler.sendChatCommand(skriptGuiCommand);
                                                    } catch (final Throwable throwable) {
                                                        ChatUtils.errorChatMessage("Failed to dupe with skript due to: " + throwable);
                                                    }
                                                }
                                            }).start();
                                            return singleSuccess;
                                        })
                                )
                        )
                );
    }

}
