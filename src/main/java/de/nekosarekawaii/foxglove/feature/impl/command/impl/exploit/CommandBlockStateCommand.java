package de.nekosarekawaii.foxglove.feature.impl.command.impl.exploit;

import com.mojang.brigadier.arguments.StringArgumentType;
import com.mojang.brigadier.builder.LiteralArgumentBuilder;
import de.nekosarekawaii.foxglove.feature.FeatureCategory;
import de.nekosarekawaii.foxglove.feature.impl.command.Command;
import net.minecraft.block.entity.CommandBlockBlockEntity;
import net.minecraft.command.CommandSource;
import net.minecraft.network.packet.c2s.play.UpdateCommandBlockC2SPacket;
import net.minecraft.util.math.BlockPos;

public class CommandBlockStateCommand extends Command {

    public CommandBlockStateCommand() {
        super(
                "Command Block State",
                "Checks if command blocks are enabled on the server.",
                FeatureCategory.EXPLOIT,
                false,
                "commandblockstate",
                "cmdblockcheck",
                "checkcmdblock",
                "checkcommandblock",
                "cmdblockstatecheck"
        );
    }

    @Override
    public void build(final LiteralArgumentBuilder<CommandSource> builder) {
        builder.then(argument("command", StringArgumentType.greedyString()).executes(context -> {
            final String command = context.getArgument("command", String.class);
            if (networkHandler() != null) {
                networkHandler().sendPacket(new UpdateCommandBlockC2SPacket(
                        BlockPos.ORIGIN, command,
                        CommandBlockBlockEntity.Type.AUTO,
                        false,
                        false,
                        false
                ));
            }
            return singleSuccess;
        }));
    }

}
