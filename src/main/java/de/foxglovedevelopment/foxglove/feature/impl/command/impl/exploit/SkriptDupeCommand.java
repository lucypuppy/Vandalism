package de.foxglovedevelopment.foxglove.feature.impl.command.impl.exploit;

import com.mojang.brigadier.arguments.LongArgumentType;
import com.mojang.brigadier.arguments.StringArgumentType;
import com.mojang.brigadier.builder.LiteralArgumentBuilder;
import de.foxglovedevelopment.foxglove.feature.FeatureCategory;
import de.foxglovedevelopment.foxglove.feature.impl.command.Command;
import de.foxglovedevelopment.foxglove.util.ChatUtils;
import net.minecraft.command.CommandSource;

public class SkriptDupeCommand extends Command {

    public SkriptDupeCommand() {
        super(
                "Skript Dupe",
                "Allows you to dupe on servers that are using the plugin skript for guis.",
                FeatureCategory.EXPLOIT,
                false,
                "skriptdupe",
                "skdupe",
                "dupesk",
                "dupeskript",
                "skriptguidupe"
        );
    }

    @Override
    public void build(final LiteralArgumentBuilder<CommandSource> builder) {
        builder.then(argument("delay", LongArgumentType.longArg(100, 15000))
                .then(argument("skript-gui-command", StringArgumentType.word())
                        .then(argument("layer-gui-command", StringArgumentType.word())
                                .executes(context -> {
                                    new Thread(() -> {
                                        if (networkHandler() != null) {
                                            try {
                                                final long delay = LongArgumentType.getLong(context, "delay");
                                                final String
                                                        skriptGuiCommand = StringArgumentType.getString(context, "skript-gui-command"),
                                                        layerGuiCommand = StringArgumentType.getString(context, "layer-gui-command");
                                                networkHandler().sendChatCommand(skriptGuiCommand);
                                                Thread.sleep(delay);
                                                networkHandler().sendChatCommand(layerGuiCommand);
                                                Thread.sleep(delay);
                                                networkHandler().sendChatCommand(skriptGuiCommand);
                                            } catch (final Throwable throwable) {
                                                ChatUtils.errorChatMessage("Failed to dupe with skript due to: " + throwable);
                                            }
                                        }
                                    }).start();
                                    return singleSuccess;
                                })
                        )
                )
        );
    }

}
