package me.nekosarekawaii.foxglove.feature.impl.command.impl.exploit;

import com.mojang.brigadier.arguments.StringArgumentType;
import com.mojang.brigadier.builder.LiteralArgumentBuilder;
import me.nekosarekawaii.foxglove.feature.FeatureCategory;
import me.nekosarekawaii.foxglove.feature.impl.command.Command;
import me.nekosarekawaii.foxglove.feature.impl.command.CommandInfo;
import net.minecraft.block.entity.CommandBlockBlockEntity;
import net.minecraft.client.network.ClientPlayNetworkHandler;
import net.minecraft.command.CommandSource;
import net.minecraft.network.packet.c2s.play.UpdateCommandBlockC2SPacket;
import net.minecraft.util.math.BlockPos;

@CommandInfo(name = "Command Block State", aliases = {"commandblockstate", "checkcmd", "checkcommandblock", "commandblockcheck"}, description = "Checks if command blocks are enabled on the server.", category = FeatureCategory.EXPLOIT)
public class CommandBlockStateCommand extends Command {

    @Override
    public void build(final LiteralArgumentBuilder<CommandSource> builder) {
        builder.then(argument("command", StringArgumentType.greedyString()).executes(context -> {
            final String command = context.getArgument("command", String.class);
            final ClientPlayNetworkHandler networkHandler = mc.getNetworkHandler();
            if (networkHandler != null) {
                networkHandler.sendPacket(new UpdateCommandBlockC2SPacket(
                        BlockPos.ORIGIN, command,
                        CommandBlockBlockEntity.Type.AUTO,
                        false,
                        false,
                        false
                ));
            }
            return singleSuccess;
        }));
    }

}
